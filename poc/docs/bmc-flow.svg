<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.1.2 (20260124.0452)
 -->
<!-- Title: bmc_discovery Pages: 1 -->
<svg width="2451pt" height="2069pt"
 viewBox="0.00 0.00 2451.00 2069.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2064.94)">
<title>bmc_discovery</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-2064.94 2446.63,-2064.94 2446.63,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="1221.31" y="-2045.54" font-family="Helvetica,Arial,sans-serif" font-size="12.00">BMC Discovery — DHCP → NetBox</text>
<text xml:space="preserve" text-anchor="middle" x="1221.31" y="-2031.29" font-family="Helvetica,Arial,sans-serif" font-size="12.00">dhcp_hook2.sh &#160;| &#160;netbox&#45;bmc&#45;worker.sh &#160;→ &#160;scripts/lib/bmc&#45;fsm.sh</text>
<g id="clust1" class="cluster">
<title>cluster_hook</title>
<polygon fill="#eef6ff" stroke="#2255aa" points="2027,-1239.42 2027,-1792.71 2359,-1792.71 2359,-1239.42 2027,-1239.42"/>
<text xml:space="preserve" text-anchor="middle" x="2193" y="-1776.36" font-family="Helvetica,Arial,sans-serif" font-size="13.00" fill="#2255aa">dhcp_hook2.sh</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_worker</title>
<polygon fill="#efffef" stroke="#1a6b1a" points="313,-1239.42 313,-2016.44 739,-2016.44 739,-1239.42 313,-1239.42"/>
<text xml:space="preserve" text-anchor="middle" x="526" y="-2000.09" font-family="Helvetica,Arial,sans-serif" font-size="13.00" fill="#1a6b1a">netbox&#45;bmc&#45;worker.sh</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_find</title>
<polygon fill="#f5eeff" stroke="#6625a8" points="755,-1232.22 755,-1320.27 2003,-1320.27 2003,-1232.22 755,-1232.22"/>
<text xml:space="preserve" text-anchor="middle" x="1379" y="-1304.87" font-family="Helvetica,Arial,sans-serif" font-size="12.00" fill="#6625a8">nb_find_device_by_bmc_mac() &#160;[lib/bmc&#45;fsm.sh]</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_fsm_proc</title>
<polygon fill="#fffde7" stroke="#e6a817" points="1392,-650.05 1392,-1198.47 1814,-1198.47 1814,-650.05 1392,-650.05"/>
<text xml:space="preserve" text-anchor="middle" x="1603" y="-1183.07" font-family="Helvetica,Arial,sans-serif" font-size="12.00" fill="#7a5000">fsm_process_bmc_event() &#160;[lib/bmc&#45;fsm.sh]</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_active</title>
<polygon fill="#e8f5e9" stroke="#2e7d32" points="332,-77.27 332,-512.02 768,-512.02 768,-77.27 332,-77.27"/>
<text xml:space="preserve" text-anchor="middle" x="550" y="-497.57" font-family="Helvetica,Arial,sans-serif" font-size="11.00">_fsm_active_refresh() &#160;[active → active]</text>
<text xml:space="preserve" text-anchor="middle" x="550" y="-484.07" font-family="Helvetica,Arial,sans-serif" font-size="11.00">live device — BMC IP refresh only</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_offline</title>
<polygon fill="#e3f2fd" stroke="#1565c0" points="8,-77.27 8,-742.07 309,-742.07 309,-77.27 8,-77.27"/>
<text xml:space="preserve" text-anchor="middle" x="158.5" y="-727.62" font-family="Helvetica,Arial,sans-serif" font-size="11.00">_fsm_offline_to_discovered() &#160;[offline → discovered]</text>
<text xml:space="preserve" text-anchor="middle" x="158.5" y="-714.12" font-family="Helvetica,Arial,sans-serif" font-size="11.00">new device — full onboarding</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_discovered</title>
<polygon fill="#e0f7fa" stroke="#00695c" points="792,-77.27 792,-512.02 1093,-512.02 1093,-77.27 792,-77.27"/>
<text xml:space="preserve" text-anchor="middle" x="942.5" y="-497.57" font-family="Helvetica,Arial,sans-serif" font-size="11.00">_fsm_discovered_refresh() &#160;[discovered → discovered]</text>
<text xml:space="preserve" text-anchor="middle" x="942.5" y="-484.07" font-family="Helvetica,Arial,sans-serif" font-size="11.00">already seen — refresh IP</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_stubs</title>
<polygon fill="#f5f5f5" stroke="#9e9e9e" stroke-dasharray="5,2" points="565,-649.3 565,-723.7 1384,-723.7 1384,-649.3 565,-649.3"/>
<text xml:space="preserve" text-anchor="middle" x="974.5" y="-709.25" font-family="Helvetica,Arial,sans-serif" font-size="11.00" fill="#9e9e9e">Future transitions — add function + uncomment FSM_TRANSITIONS row</text>
</g>
<!-- exit_ok -->
<g id="node1" class="node">
<title>exit_ok</title>
<ellipse fill="#d4edda" stroke="#28a745" cx="2276" cy="-911.32" rx="36.36" ry="18.14"/>
<text xml:space="preserve" text-anchor="middle" x="2276" y="-907.45" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Exit 0</text>
</g>
<!-- exit_err -->
<g id="node2" class="node">
<title>exit_err</title>
<ellipse fill="#f8d7da" stroke="#dc3545" cx="865" cy="-1616.37" rx="36.36" ry="18.14"/>
<text xml:space="preserve" text-anchor="middle" x="865" y="-1612.5" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Exit 1</text>
</g>
<!-- done -->
<g id="node3" class="node">
<title>done</title>
<ellipse fill="#d4edda" stroke="#28a745" cx="810" cy="-18.14" rx="34.77" ry="18.14"/>
<text xml:space="preserve" text-anchor="middle" x="810" y="-14.26" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Done</text>
</g>
<!-- w_loop -->
<g id="node14" class="node">
<title>w_loop</title>
<ellipse fill="#c3e6cb" stroke="#155724" cx="467" cy="-1737.12" rx="48.03" ry="18.14"/>
<text xml:space="preserve" text-anchor="middle" x="467" y="-1733.24" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Main loop</text>
</g>
<!-- done&#45;&gt;w_loop -->
<g id="edge56" class="edge">
<title>done&#45;&gt;w_loop</title>
<path fill="none" stroke="#888888" stroke-dasharray="5,2" d="M844.9,-20.36C947.07,-24.34 1243.86,-39 1332,-77.27 1867.7,-309.9 2633.34,-429.49 2332,-929.77 2200.21,-1148.57 2071.59,-1135.71 1824,-1198.47 1780.86,-1209.41 1067.44,-1204.2 1023,-1206.47 1007.51,-1207.27 755.45,-1220.76 745,-1232.22 658.3,-1327.33 773.4,-1394.99 751,-1521.72 740.17,-1583.01 746.01,-1608.29 703,-1653.27 648.44,-1710.34 610.16,-1686.84 535,-1711.02 526.38,-1713.8 517.23,-1717 508.53,-1720.16"/>
<polygon fill="#888888" stroke="#888888" points="507.62,-1717.51 501.08,-1722.91 509.56,-1722.77 507.62,-1717.51"/>
<text xml:space="preserve" text-anchor="middle" x="2405.5" y="-860.32" font-family="Helvetica,Arial,sans-serif" font-size="9.00">worker: next event</text>
</g>
<!-- h_start -->
<g id="node4" class="node">
<title>h_start</title>
<ellipse fill="#cce5ff" stroke="#2255aa" cx="2160" cy="-1737.12" rx="114.85" ry="26.09"/>
<text xml:space="preserve" text-anchor="middle" x="2160" y="-1738.87" font-family="Helvetica,Arial,sans-serif" font-size="10.00">dhcpd executes hook</text>
<text xml:space="preserve" text-anchor="middle" x="2160" y="-1727.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">$1=IP &#160;$2=MAC &#160;$3=hostname</text>
</g>
<!-- h_valid -->
<g id="node5" class="node">
<title>h_valid</title>
<path fill="#fff3cd" stroke="#856404" d="M2149.11,-1648.24C2149.11,-1648.24 2090.97,-1621.4 2090.97,-1621.4 2085.53,-1618.89 2085.53,-1613.86 2090.97,-1611.34 2090.97,-1611.34 2149.11,-1584.5 2149.11,-1584.5 2154.55,-1581.99 2165.45,-1581.99 2170.89,-1584.5 2170.89,-1584.5 2229.03,-1611.34 2229.03,-1611.34 2234.47,-1613.86 2234.47,-1618.89 2229.03,-1621.4 2229.03,-1621.4 2170.89,-1648.24 2170.89,-1648.24 2165.45,-1650.76 2154.55,-1650.76 2149.11,-1648.24"/>
<text xml:space="preserve" text-anchor="middle" x="2160" y="-1618.12" font-family="Helvetica,Arial,sans-serif" font-size="10.00">IP and MAC</text>
<text xml:space="preserve" text-anchor="middle" x="2160" y="-1606.87" font-family="Helvetica,Arial,sans-serif" font-size="10.00">not empty?</text>
</g>
<!-- h_start&#45;&gt;h_valid -->
<g id="edge1" class="edge">
<title>h_start&#45;&gt;h_valid</title>
<path fill="none" stroke="#555555" d="M2160,-1710.64C2160,-1696.74 2160,-1679.12 2160,-1662.94"/>
<polygon fill="#555555" stroke="#555555" points="2162.8,-1663.13 2160,-1655.13 2157.2,-1663.13 2162.8,-1663.13"/>
</g>
<!-- h_err -->
<g id="node6" class="node">
<title>h_err</title>
<path fill="#f8d7da" stroke="#721c24" d="M2339.46,-1521.27C2339.46,-1521.27 2238.54,-1521.27 2238.54,-1521.27 2232.54,-1521.27 2226.54,-1515.27 2226.54,-1509.27 2226.54,-1509.27 2226.54,-1497.27 2226.54,-1497.27 2226.54,-1491.27 2232.54,-1485.27 2238.54,-1485.27 2238.54,-1485.27 2339.46,-1485.27 2339.46,-1485.27 2345.46,-1485.27 2351.46,-1491.27 2351.46,-1497.27 2351.46,-1497.27 2351.46,-1509.27 2351.46,-1509.27 2351.46,-1515.27 2345.46,-1521.27 2339.46,-1521.27"/>
<text xml:space="preserve" text-anchor="middle" x="2289" y="-1499.4" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_error: missing args</text>
</g>
<!-- h_valid&#45;&gt;h_err -->
<g id="edge2" class="edge">
<title>h_valid&#45;&gt;h_err</title>
<path fill="none" stroke="#555555" d="M2187.36,-1591.81C2209.29,-1572.93 2239.9,-1546.56 2261.79,-1527.71"/>
<polygon fill="#555555" stroke="#555555" points="2263.47,-1529.96 2267.71,-1522.61 2259.82,-1525.71 2263.47,-1529.96"/>
<text xml:space="preserve" text-anchor="middle" x="2245.1" y="-1546.92" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no</text>
</g>
<!-- h_norm -->
<g id="node7" class="node">
<title>h_norm</title>
<path fill="#e8f4f8" stroke="#446688" d="M2174.59,-1521.72C2174.59,-1521.72 2047.41,-1521.72 2047.41,-1521.72 2041.41,-1521.72 2035.41,-1515.72 2035.41,-1509.72 2035.41,-1509.72 2035.41,-1496.82 2035.41,-1496.82 2035.41,-1490.82 2041.41,-1484.82 2047.41,-1484.82 2047.41,-1484.82 2174.59,-1484.82 2174.59,-1484.82 2180.59,-1484.82 2186.59,-1490.82 2186.59,-1496.82 2186.59,-1496.82 2186.59,-1509.72 2186.59,-1509.72 2186.59,-1515.72 2180.59,-1521.72 2174.59,-1521.72"/>
<text xml:space="preserve" text-anchor="middle" x="2111" y="-1505.02" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Normalize MAC</text>
<text xml:space="preserve" text-anchor="middle" x="2111" y="-1493.77" font-family="Helvetica,Arial,sans-serif" font-size="10.00">lower&#45;case · colon&#45;separated</text>
</g>
<!-- h_valid&#45;&gt;h_norm -->
<g id="edge3" class="edge">
<title>h_valid&#45;&gt;h_norm</title>
<path fill="none" stroke="#555555" d="M2146.74,-1585.31C2139.23,-1568.28 2129.92,-1547.18 2122.69,-1530.78"/>
<polygon fill="#555555" stroke="#555555" points="2125.31,-1529.78 2119.52,-1523.59 2120.19,-1532.04 2125.31,-1529.78"/>
<text xml:space="preserve" text-anchor="middle" x="2139.69" y="-1546.92" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- h_err&#45;&gt;exit_ok -->
<g id="edge4" class="edge">
<title>h_err&#45;&gt;exit_ok</title>
<path fill="none" stroke="#555555" d="M2322.73,-1484.86C2351.07,-1467.53 2387,-1438.06 2387,-1399.92 2387,-1399.92 2387,-1399.92 2387,-1007.47 2387,-967.86 2345.75,-941.19 2313.55,-926.4"/>
<polygon fill="#555555" stroke="#555555" points="2315,-923.98 2306.55,-923.32 2312.75,-929.1 2315,-923.98"/>
</g>
<!-- h_oui -->
<g id="node8" class="node">
<title>h_oui</title>
<path fill="#fff3cd" stroke="#856404" d="M2138.57,-1432.16C2138.57,-1432.16 2046.26,-1402.59 2046.26,-1402.59 2040.54,-1400.76 2040.54,-1397.09 2046.26,-1395.26 2046.26,-1395.26 2138.57,-1365.69 2138.57,-1365.69 2144.29,-1363.86 2155.71,-1363.86 2161.43,-1365.69 2161.43,-1365.69 2253.74,-1395.26 2253.74,-1395.26 2259.46,-1397.09 2259.46,-1400.76 2253.74,-1402.59 2253.74,-1402.59 2161.43,-1432.16 2161.43,-1432.16 2155.71,-1433.99 2144.29,-1433.99 2138.57,-1432.16"/>
<text xml:space="preserve" text-anchor="middle" x="2150" y="-1400.67" font-family="Helvetica,Arial,sans-serif" font-size="10.00">is_bmc_mac()</text>
<text xml:space="preserve" text-anchor="middle" x="2150" y="-1389.42" font-family="Helvetica,Arial,sans-serif" font-size="10.00">OUI in BMC_OUIS?</text>
</g>
<!-- h_norm&#45;&gt;h_oui -->
<g id="edge5" class="edge">
<title>h_norm&#45;&gt;h_oui</title>
<path fill="none" stroke="#555555" d="M2117.79,-1484.45C2122.39,-1472.38 2128.66,-1455.94 2134.44,-1440.76"/>
<polygon fill="#555555" stroke="#555555" points="2137,-1441.9 2137.23,-1433.42 2131.77,-1439.9 2137,-1441.9"/>
</g>
<!-- h_skip -->
<g id="node9" class="node">
<title>h_skip</title>
<path fill="#f8d7da" stroke="#721c24" d="M2314.46,-1284.32C2314.46,-1284.32 2237.54,-1284.32 2237.54,-1284.32 2231.54,-1284.32 2225.54,-1278.32 2225.54,-1272.32 2225.54,-1272.32 2225.54,-1259.42 2225.54,-1259.42 2225.54,-1253.42 2231.54,-1247.42 2237.54,-1247.42 2237.54,-1247.42 2314.46,-1247.42 2314.46,-1247.42 2320.46,-1247.42 2326.46,-1253.42 2326.46,-1259.42 2326.46,-1259.42 2326.46,-1272.32 2326.46,-1272.32 2326.46,-1278.32 2320.46,-1284.32 2314.46,-1284.32"/>
<text xml:space="preserve" text-anchor="middle" x="2276" y="-1267.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Not a BMC MAC</text>
<text xml:space="preserve" text-anchor="middle" x="2276" y="-1256.37" font-family="Helvetica,Arial,sans-serif" font-size="10.00">— silent exit</text>
</g>
<!-- h_oui&#45;&gt;h_skip -->
<g id="edge6" class="edge">
<title>h_oui&#45;&gt;h_skip</title>
<path fill="none" stroke="#555555" d="M2176.72,-1370.13C2199.24,-1346.71 2231.14,-1313.53 2252.65,-1291.16"/>
<polygon fill="#555555" stroke="#555555" points="2254.4,-1293.38 2257.93,-1285.67 2250.36,-1289.5 2254.4,-1293.38"/>
<text xml:space="preserve" text-anchor="middle" x="2235.53" y="-1329.47" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no match</text>
</g>
<!-- h_call -->
<g id="node10" class="node">
<title>h_call</title>
<path fill="#fff9c4" stroke="#856404" d="M2173.21,-1284.32C2173.21,-1284.32 2046.79,-1284.32 2046.79,-1284.32 2040.79,-1284.32 2034.79,-1278.32 2034.79,-1272.32 2034.79,-1272.32 2034.79,-1259.42 2034.79,-1259.42 2034.79,-1253.42 2040.79,-1247.42 2046.79,-1247.42 2046.79,-1247.42 2173.21,-1247.42 2173.21,-1247.42 2179.21,-1247.42 2185.21,-1253.42 2185.21,-1259.42 2185.21,-1259.42 2185.21,-1272.32 2185.21,-1272.32 2185.21,-1278.32 2179.21,-1284.32 2173.21,-1284.32"/>
<text xml:space="preserve" text-anchor="middle" x="2110" y="-1267.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">fsm_process_bmc_event()</text>
<text xml:space="preserve" text-anchor="middle" x="2110" y="-1256.37" font-family="Helvetica,Arial,sans-serif" font-size="10.00">trigger=dhcp_seen · mac · ip</text>
</g>
<!-- h_oui&#45;&gt;h_call -->
<g id="edge7" class="edge">
<title>h_oui&#45;&gt;h_call</title>
<path fill="none" stroke="#555555" d="M2139.91,-1364.86C2133.16,-1342.76 2124.41,-1314.08 2118.12,-1293.47"/>
<polygon fill="#555555" stroke="#555555" points="2120.87,-1292.9 2115.86,-1286.06 2115.51,-1294.53 2120.87,-1292.9"/>
<text xml:space="preserve" text-anchor="middle" x="2143.57" y="-1329.47" font-family="Helvetica,Arial,sans-serif" font-size="9.00">match</text>
</g>
<!-- h_skip&#45;&gt;exit_ok -->
<g id="edge8" class="edge">
<title>h_skip&#45;&gt;exit_ok</title>
<path fill="none" stroke="#555555" d="M2276,-1247.39C2276,-1190.18 2276,-1008.29 2276,-939.25"/>
<polygon fill="#555555" stroke="#555555" points="2278.8,-939.43 2276,-931.43 2273.2,-939.43 2278.8,-939.43"/>
</g>
<!-- fp_find -->
<g id="node27" class="node">
<title>fp_find</title>
<path fill="#e8f4f8" stroke="#446688" d="M1585.84,-1150.82C1585.84,-1150.82 1412.16,-1150.82 1412.16,-1150.82 1406.16,-1150.82 1400.16,-1144.82 1400.16,-1138.82 1400.16,-1138.82 1400.16,-1126.82 1400.16,-1126.82 1400.16,-1120.82 1406.16,-1114.82 1412.16,-1114.82 1412.16,-1114.82 1585.84,-1114.82 1585.84,-1114.82 1591.84,-1114.82 1597.84,-1120.82 1597.84,-1126.82 1597.84,-1126.82 1597.84,-1138.82 1597.84,-1138.82 1597.84,-1144.82 1591.84,-1150.82 1585.84,-1150.82"/>
<text xml:space="preserve" text-anchor="middle" x="1499" y="-1128.95" font-family="Helvetica,Arial,sans-serif" font-size="10.00">call nb_find_device_by_bmc_mac(mac)</text>
</g>
<!-- h_call&#45;&gt;fp_find -->
<g id="edge9" class="edge">
<title>h_call&#45;&gt;fp_find</title>
<path fill="none" stroke="#555555" d="M2065.79,-1247.02C2049.47,-1241.23 2030.65,-1235.46 2013,-1232.22 1921.9,-1215.5 1682.85,-1249.72 1596.5,-1216.22 1588.05,-1212.95 1579.8,-1208.61 1571.92,-1203.64"/>
<polygon fill="#555555" stroke="#555555" points="1573.64,-1201.42 1565.43,-1199.31 1570.53,-1206.08 1573.64,-1201.42"/>
<text xml:space="preserve" text-anchor="middle" x="1598.75" y="-1207.67" font-family="Helvetica,Arial,sans-serif" font-size="9.00"> &#160;</text>
</g>
<!-- w_start -->
<g id="node11" class="node">
<title>w_start</title>
<ellipse fill="#c3e6cb" stroke="#155724" cx="554" cy="-1960.85" rx="86.21" ry="26.09"/>
<text xml:space="preserve" text-anchor="middle" x="554" y="-1962.6" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Worker process starts</text>
<text xml:space="preserve" text-anchor="middle" x="554" y="-1951.35" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log config + banner</text>
</g>
<!-- w_ping -->
<g id="node12" class="node">
<title>w_ping</title>
<path fill="#fff3cd" stroke="#856404" d="M542.39,-1882.74C542.39,-1882.74 466.94,-1863.13 466.94,-1863.13 461.14,-1861.62 461.14,-1858.6 466.94,-1857.09 466.94,-1857.09 542.39,-1837.48 542.39,-1837.48 548.19,-1835.97 559.81,-1835.97 565.61,-1837.48 565.61,-1837.48 641.06,-1857.09 641.06,-1857.09 646.86,-1858.6 646.86,-1861.62 641.06,-1863.13 641.06,-1863.13 565.61,-1882.74 565.61,-1882.74 559.81,-1884.25 548.19,-1884.25 542.39,-1882.74"/>
<text xml:space="preserve" text-anchor="middle" x="554" y="-1856.23" font-family="Helvetica,Arial,sans-serif" font-size="10.00">redis_cmd PING</text>
</g>
<!-- w_start&#45;&gt;w_ping -->
<g id="edge10" class="edge">
<title>w_start&#45;&gt;w_ping</title>
<path fill="none" stroke="#555555" d="M554,-1934.42C554,-1922.58 554,-1908.32 554,-1895.53"/>
<polygon fill="#555555" stroke="#555555" points="556.8,-1895.62 554,-1887.62 551.2,-1895.62 556.8,-1895.62"/>
</g>
<!-- w_perr -->
<g id="node13" class="node">
<title>w_perr</title>
<path fill="#f8d7da" stroke="#721c24" d="M718.96,-1755.12C718.96,-1755.12 567.04,-1755.12 567.04,-1755.12 561.04,-1755.12 555.04,-1749.12 555.04,-1743.12 555.04,-1743.12 555.04,-1731.12 555.04,-1731.12 555.04,-1725.12 561.04,-1719.12 567.04,-1719.12 567.04,-1719.12 718.96,-1719.12 718.96,-1719.12 724.96,-1719.12 730.96,-1725.12 730.96,-1731.12 730.96,-1731.12 730.96,-1743.12 730.96,-1743.12 730.96,-1749.12 724.96,-1755.12 718.96,-1755.12"/>
<text xml:space="preserve" text-anchor="middle" x="643" y="-1733.24" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_error: cannot connect to Redis</text>
</g>
<!-- w_ping&#45;&gt;w_perr -->
<g id="edge11" class="edge">
<title>w_ping&#45;&gt;w_perr</title>
<path fill="none" stroke="#555555" d="M569.5,-1838.03C584.92,-1817.08 608.55,-1784.95 624.84,-1762.81"/>
<polygon fill="#555555" stroke="#555555" points="626.88,-1764.75 629.37,-1756.65 622.37,-1761.43 626.88,-1764.75"/>
<text xml:space="preserve" text-anchor="middle" x="601.83" y="-1801.91" font-family="Helvetica,Arial,sans-serif" font-size="9.00">fail</text>
</g>
<!-- w_ping&#45;&gt;w_loop -->
<g id="edge12" class="edge">
<title>w_ping&#45;&gt;w_loop</title>
<path fill="none" stroke="#555555" d="M538.85,-1838.03C523.76,-1817.05 500.61,-1784.86 484.69,-1762.72"/>
<polygon fill="#555555" stroke="#555555" points="487,-1761.14 480.06,-1756.28 482.46,-1764.41 487,-1761.14"/>
<text xml:space="preserve" text-anchor="middle" x="523.17" y="-1801.91" font-family="Helvetica,Arial,sans-serif" font-size="9.00">ok</text>
</g>
<!-- w_perr&#45;&gt;exit_err -->
<g id="edge13" class="edge">
<title>w_perr&#45;&gt;exit_err</title>
<path fill="none" stroke="#555555" d="M731.11,-1726.27C762.83,-1719.29 797.34,-1707.37 824,-1687.02 838.5,-1675.96 848.85,-1658.17 855.52,-1643.34"/>
<polygon fill="#555555" stroke="#555555" points="858.1,-1644.43 858.62,-1635.97 852.94,-1642.26 858.1,-1644.43"/>
</g>
<!-- w_brpop -->
<g id="node15" class="node">
<title>w_brpop</title>
<path fill="#fff3cd" stroke="#856404" d="M502.17,-1640.02C502.17,-1640.02 374.66,-1618.38 374.66,-1618.38 368.75,-1617.38 368.75,-1615.37 374.66,-1614.37 374.66,-1614.37 502.17,-1592.73 502.17,-1592.73 508.08,-1591.73 519.92,-1591.73 525.83,-1592.73 525.83,-1592.73 653.34,-1614.37 653.34,-1614.37 659.25,-1615.37 659.25,-1617.38 653.34,-1618.38 653.34,-1618.38 525.83,-1640.02 525.83,-1640.02 519.92,-1641.02 508.08,-1641.02 502.17,-1640.02"/>
<text xml:space="preserve" text-anchor="middle" x="514" y="-1612.5" font-family="Helvetica,Arial,sans-serif" font-size="10.00">BRPOP &#160;queue &#160;timeout=1 s</text>
</g>
<!-- w_loop&#45;&gt;w_brpop -->
<g id="edge14" class="edge">
<title>w_loop&#45;&gt;w_brpop</title>
<path fill="none" stroke="#555555" d="M482.69,-1719.73C490.36,-1710.76 499,-1699.05 504,-1687.02 508.58,-1676.01 511.12,-1663.26 512.51,-1651.71"/>
<polygon fill="#555555" stroke="#555555" points="515.29,-1652.09 513.28,-1643.85 509.72,-1651.54 515.29,-1652.09"/>
</g>
<!-- w_brpop&#45;&gt;w_loop -->
<g id="edge16" class="edge">
<title>w_brpop&#45;&gt;w_loop</title>
<path fill="none" stroke="#555555" d="M490.3,-1638.27C480.12,-1648.82 469.36,-1662.5 464,-1677.27 460.35,-1687.33 460.19,-1698.99 461.27,-1709.27"/>
<polygon fill="#555555" stroke="#555555" points="458.48,-1709.58 462.39,-1717.1 464.03,-1708.78 458.48,-1709.58"/>
<text xml:space="preserve" text-anchor="middle" x="479" y="-1678.47" font-family="Helvetica,Arial,sans-serif" font-size="9.00">timeout</text>
</g>
<!-- w_rerr -->
<g id="node16" class="node">
<title>w_rerr</title>
<path fill="#f8d7da" stroke="#721c24" d="M719.46,-1521.72C719.46,-1521.72 612.54,-1521.72 612.54,-1521.72 606.54,-1521.72 600.54,-1515.72 600.54,-1509.72 600.54,-1509.72 600.54,-1496.82 600.54,-1496.82 600.54,-1490.82 606.54,-1484.82 612.54,-1484.82 612.54,-1484.82 719.46,-1484.82 719.46,-1484.82 725.46,-1484.82 731.46,-1490.82 731.46,-1496.82 731.46,-1496.82 731.46,-1509.72 731.46,-1509.72 731.46,-1515.72 725.46,-1521.72 719.46,-1521.72"/>
<text xml:space="preserve" text-anchor="middle" x="666" y="-1505.02" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_error: BRPOP failed</text>
<text xml:space="preserve" text-anchor="middle" x="666" y="-1493.77" font-family="Helvetica,Arial,sans-serif" font-size="10.00">sleep 5 s · retry</text>
</g>
<!-- w_brpop&#45;&gt;w_rerr -->
<g id="edge15" class="edge">
<title>w_brpop&#45;&gt;w_rerr</title>
<path fill="none" stroke="#555555" d="M541.88,-1595C568.04,-1575.87 607.14,-1547.3 634.44,-1527.34"/>
<polygon fill="#555555" stroke="#555555" points="635.78,-1529.83 640.58,-1522.85 632.47,-1525.31 635.78,-1529.83"/>
<text xml:space="preserve" text-anchor="middle" x="617.83" y="-1546.92" font-family="Helvetica,Arial,sans-serif" font-size="9.00">error</text>
</g>
<!-- w_parse -->
<g id="node17" class="node">
<title>w_parse</title>
<path fill="#e8f4f8" stroke="#446688" d="M548.84,-1521.72C548.84,-1521.72 375.17,-1521.72 375.17,-1521.72 369.17,-1521.72 363.17,-1515.72 363.17,-1509.72 363.17,-1509.72 363.17,-1496.82 363.17,-1496.82 363.17,-1490.82 369.17,-1484.82 375.17,-1484.82 375.17,-1484.82 548.84,-1484.82 548.84,-1484.82 554.84,-1484.82 560.84,-1490.82 560.84,-1496.82 560.84,-1496.82 560.84,-1509.72 560.84,-1509.72 560.84,-1515.72 554.84,-1521.72 548.84,-1521.72"/>
<text xml:space="preserve" text-anchor="middle" x="462" y="-1505.02" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Parse JSON event</text>
<text xml:space="preserve" text-anchor="middle" x="462" y="-1493.77" font-family="Helvetica,Arial,sans-serif" font-size="10.00">event_type · mac_address · ip_address</text>
</g>
<!-- w_brpop&#45;&gt;w_parse -->
<g id="edge17" class="edge">
<title>w_brpop&#45;&gt;w_parse</title>
<path fill="none" stroke="#555555" d="M503.1,-1592.08C494.67,-1574.07 482.99,-1549.12 474.24,-1530.42"/>
<polygon fill="#555555" stroke="#555555" points="476.89,-1529.49 470.97,-1523.43 471.82,-1531.86 476.89,-1529.49"/>
<text xml:space="preserve" text-anchor="middle" x="496.14" y="-1546.92" font-family="Helvetica,Arial,sans-serif" font-size="9.00">event</text>
</g>
<!-- w_rerr&#45;&gt;w_loop -->
<g id="edge18" class="edge">
<title>w_rerr&#45;&gt;w_loop</title>
<path fill="none" stroke="#555555" d="M675.43,-1522.16C689.79,-1552.13 712.69,-1613.13 685,-1653.27 683.68,-1655.19 571.82,-1697.08 508.87,-1720.54"/>
<polygon fill="#555555" stroke="#555555" points="508.27,-1717.78 501.75,-1723.2 510.22,-1723.03 508.27,-1717.78"/>
</g>
<!-- w_valid -->
<g id="node18" class="node">
<title>w_valid</title>
<path fill="#fff3cd" stroke="#856404" d="M465.59,-1432.12C465.59,-1432.12 374.74,-1402.63 374.74,-1402.63 369.04,-1400.78 369.04,-1397.07 374.74,-1395.22 374.74,-1395.22 465.59,-1365.73 465.59,-1365.73 471.29,-1363.88 482.71,-1363.88 488.41,-1365.73 488.41,-1365.73 579.26,-1395.22 579.26,-1395.22 584.96,-1397.07 584.96,-1400.78 579.26,-1402.63 579.26,-1402.63 488.41,-1432.12 488.41,-1432.12 482.71,-1433.97 471.29,-1433.97 465.59,-1432.12"/>
<text xml:space="preserve" text-anchor="middle" x="477" y="-1400.67" font-family="Helvetica,Arial,sans-serif" font-size="10.00">mac_address and</text>
<text xml:space="preserve" text-anchor="middle" x="477" y="-1389.42" font-family="Helvetica,Arial,sans-serif" font-size="10.00">ip_address present?</text>
</g>
<!-- w_parse&#45;&gt;w_valid -->
<g id="edge19" class="edge">
<title>w_parse&#45;&gt;w_valid</title>
<path fill="none" stroke="#555555" d="M464.61,-1484.45C466.27,-1473.17 468.48,-1458.07 470.58,-1443.75"/>
<polygon fill="#555555" stroke="#555555" points="473.32,-1444.32 471.71,-1436 467.78,-1443.51 473.32,-1444.32"/>
</g>
<!-- w_verr -->
<g id="node19" class="node">
<title>w_verr</title>
<path fill="#f8d7da" stroke="#721c24" d="M438.71,-1283.87C438.71,-1283.87 333.29,-1283.87 333.29,-1283.87 327.29,-1283.87 321.29,-1277.87 321.29,-1271.87 321.29,-1271.87 321.29,-1259.87 321.29,-1259.87 321.29,-1253.87 327.29,-1247.87 333.29,-1247.87 333.29,-1247.87 438.71,-1247.87 438.71,-1247.87 444.71,-1247.87 450.71,-1253.87 450.71,-1259.87 450.71,-1259.87 450.71,-1271.87 450.71,-1271.87 450.71,-1277.87 444.71,-1283.87 438.71,-1283.87"/>
<text xml:space="preserve" text-anchor="middle" x="386" y="-1262" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_error: missing fields</text>
</g>
<!-- w_valid&#45;&gt;w_verr -->
<g id="edge20" class="edge">
<title>w_valid&#45;&gt;w_verr</title>
<path fill="none" stroke="#555555" d="M456.58,-1368.51C440.52,-1345.39 418.41,-1313.55 403.24,-1291.7"/>
<polygon fill="#555555" stroke="#555555" points="405.71,-1290.35 398.85,-1285.38 401.11,-1293.55 405.71,-1290.35"/>
<text xml:space="preserve" text-anchor="middle" x="439.48" y="-1329.47" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no</text>
</g>
<!-- w_call -->
<g id="node20" class="node">
<title>w_call</title>
<path fill="#fff9c4" stroke="#856404" d="M629.21,-1284.32C629.21,-1284.32 502.79,-1284.32 502.79,-1284.32 496.79,-1284.32 490.79,-1278.32 490.79,-1272.32 490.79,-1272.32 490.79,-1259.42 490.79,-1259.42 490.79,-1253.42 496.79,-1247.42 502.79,-1247.42 502.79,-1247.42 629.21,-1247.42 629.21,-1247.42 635.21,-1247.42 641.21,-1253.42 641.21,-1259.42 641.21,-1259.42 641.21,-1272.32 641.21,-1272.32 641.21,-1278.32 635.21,-1284.32 629.21,-1284.32"/>
<text xml:space="preserve" text-anchor="middle" x="566" y="-1267.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">fsm_process_bmc_event()</text>
<text xml:space="preserve" text-anchor="middle" x="566" y="-1256.37" font-family="Helvetica,Arial,sans-serif" font-size="10.00">trigger=dhcp_seen · mac · ip</text>
</g>
<!-- w_valid&#45;&gt;w_call -->
<g id="edge21" class="edge">
<title>w_valid&#45;&gt;w_call</title>
<path fill="none" stroke="#555555" d="M497.2,-1368.19C512.66,-1345.42 533.77,-1314.34 548.51,-1292.63"/>
<polygon fill="#555555" stroke="#555555" points="550.8,-1294.24 552.98,-1286.05 546.16,-1291.1 550.8,-1294.24"/>
<text xml:space="preserve" text-anchor="middle" x="531.29" y="-1329.47" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- w_verr&#45;&gt;w_loop -->
<g id="edge22" class="edge">
<title>w_verr&#45;&gt;w_loop</title>
<path fill="none" stroke="#555555" d="M371.16,-1284.21C352.25,-1308.13 322,-1353.36 322,-1397.92 322,-1617.37 322,-1617.37 322,-1617.37 322,-1670.08 380.05,-1703.63 422.69,-1721.16"/>
<polygon fill="#555555" stroke="#555555" points="421.65,-1723.76 430.12,-1724.1 423.71,-1718.55 421.65,-1723.76"/>
</g>
<!-- w_call&#45;&gt;fp_find -->
<g id="edge23" class="edge">
<title>w_call&#45;&gt;fp_find</title>
<path fill="none" stroke="#555555" d="M617.9,-1246.96C634.69,-1241.64 653.5,-1236.19 671,-1232.22 748.74,-1214.61 769.43,-1216.62 848.5,-1206.47 1038.92,-1182.04 1261.32,-1158.21 1390.55,-1144.84"/>
<polygon fill="#555555" stroke="#555555" points="1382.39,-1147.33 1390.49,-1144.83 1382.6,-1141.73 1382.39,-1147.33"/>
<text xml:space="preserve" text-anchor="middle" x="850.75" y="-1207.67" font-family="Helvetica,Arial,sans-serif" font-size="9.00"> &#160;</text>
</g>
<!-- f_upper -->
<g id="node21" class="node">
<title>f_upper</title>
<path fill="#e8f4f8" stroke="#446688" d="M928.71,-1283.87C928.71,-1283.87 775.29,-1283.87 775.29,-1283.87 769.29,-1283.87 763.29,-1277.87 763.29,-1271.87 763.29,-1271.87 763.29,-1259.87 763.29,-1259.87 763.29,-1253.87 769.29,-1247.87 775.29,-1247.87 775.29,-1247.87 928.71,-1247.87 928.71,-1247.87 934.71,-1247.87 940.71,-1253.87 940.71,-1259.87 940.71,-1259.87 940.71,-1271.87 940.71,-1271.87 940.71,-1277.87 934.71,-1283.87 928.71,-1283.87"/>
<text xml:space="preserve" text-anchor="middle" x="852" y="-1262.75" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Normalize MAC → UPPER:CASE</text>
</g>
<!-- f_iface -->
<g id="node22" class="node">
<title>f_iface</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M1142.84,-1289.95C1142.84,-1289.95 993.16,-1289.95 993.16,-1289.95 987.16,-1289.95 981.16,-1283.95 981.16,-1277.95 981.16,-1277.95 981.16,-1253.8 981.16,-1253.8 981.16,-1247.8 987.16,-1241.8 993.16,-1241.8 993.16,-1241.8 1142.84,-1241.8 1142.84,-1241.8 1148.84,-1241.8 1154.84,-1247.8 1154.84,-1253.8 1154.84,-1253.8 1154.84,-1277.95 1154.84,-1277.95 1154.84,-1283.95 1148.84,-1289.95 1142.84,-1289.95"/>
<text xml:space="preserve" text-anchor="middle" x="1068" y="-1273.25" font-family="Helvetica,Arial,sans-serif" font-size="10.00">GET /api/dcim/interfaces/</text>
<text xml:space="preserve" text-anchor="middle" x="1068" y="-1262" font-family="Helvetica,Arial,sans-serif" font-size="10.00">?mac_address=MAC&amp;name=bmc</text>
<text xml:space="preserve" text-anchor="middle" x="1068" y="-1250.75" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- f_count -->
<g id="node23" class="node">
<title>f_count</title>
<path fill="#fff3cd" stroke="#856404" d="M1294.31,-1288.82C1294.31,-1288.82 1207.02,-1268.58 1207.02,-1268.58 1201.18,-1267.23 1201.18,-1264.52 1207.02,-1263.17 1207.02,-1263.17 1294.31,-1242.93 1294.31,-1242.93 1300.15,-1241.58 1311.85,-1241.58 1317.69,-1242.93 1317.69,-1242.93 1404.98,-1263.17 1404.98,-1263.17 1410.82,-1264.52 1410.82,-1267.23 1404.98,-1268.58 1404.98,-1268.58 1317.69,-1288.82 1317.69,-1288.82 1311.85,-1290.17 1300.15,-1290.17 1294.31,-1288.82"/>
<text xml:space="preserve" text-anchor="middle" x="1306" y="-1262" font-family="Helvetica,Arial,sans-serif" font-size="10.00">results.count == 0?</text>
</g>
<!-- f_none -->
<g id="node24" class="node">
<title>f_none</title>
<path fill="#f8d7da" stroke="#721c24" d="M1615.71,-1283.87C1615.71,-1283.87 1468.29,-1283.87 1468.29,-1283.87 1462.29,-1283.87 1456.29,-1277.87 1456.29,-1271.87 1456.29,-1271.87 1456.29,-1259.87 1456.29,-1259.87 1456.29,-1253.87 1462.29,-1247.87 1468.29,-1247.87 1468.29,-1247.87 1615.71,-1247.87 1615.71,-1247.87 1621.71,-1247.87 1627.71,-1253.87 1627.71,-1259.87 1627.71,-1259.87 1627.71,-1271.87 1627.71,-1271.87 1627.71,-1277.87 1621.71,-1283.87 1615.71,-1283.87"/>
<text xml:space="preserve" text-anchor="middle" x="1542" y="-1262" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_warn: no device for this MAC</text>
</g>
<!-- fp_found -->
<g id="node28" class="node">
<title>fp_found</title>
<path fill="#fff3cd" stroke="#856404" d="M1711.02,-1164.88C1711.02,-1164.88 1649.31,-1137.67 1649.31,-1137.67 1643.82,-1135.25 1643.82,-1130.4 1649.31,-1127.98 1649.31,-1127.98 1711.02,-1100.77 1711.02,-1100.77 1716.51,-1098.35 1727.49,-1098.35 1732.98,-1100.77 1732.98,-1100.77 1794.69,-1127.98 1794.69,-1127.98 1800.18,-1130.4 1800.18,-1135.25 1794.69,-1137.67 1794.69,-1137.67 1732.98,-1164.88 1732.98,-1164.88 1727.49,-1167.3 1716.51,-1167.3 1711.02,-1164.88"/>
<text xml:space="preserve" text-anchor="middle" x="1722" y="-1134.57" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Device found</text>
<text xml:space="preserve" text-anchor="middle" x="1722" y="-1123.32" font-family="Helvetica,Arial,sans-serif" font-size="10.00">in NetBox?</text>
</g>
<!-- f_none&#45;&gt;fp_found -->
<g id="edge26" class="edge">
<title>f_none&#45;&gt;fp_found</title>
<path fill="none" stroke="#555555" d="M1586.84,-1232.23C1616.64,-1210.53 1655.35,-1182.35 1683.71,-1161.71"/>
<polygon fill="#555555" stroke="#555555" points="1685.01,-1164.22 1689.83,-1157.25 1681.71,-1159.69 1685.01,-1164.22"/>
<text xml:space="preserve" text-anchor="middle" x="1641.85" y="-1207.67" font-family="Helvetica,Arial,sans-serif" font-size="9.00">return null</text>
</g>
<!-- f_dev -->
<g id="node25" class="node">
<title>f_dev</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M1800.59,-1284.32C1800.59,-1284.32 1679.41,-1284.32 1679.41,-1284.32 1673.41,-1284.32 1667.41,-1278.32 1667.41,-1272.32 1667.41,-1272.32 1667.41,-1259.42 1667.41,-1259.42 1667.41,-1253.42 1673.41,-1247.42 1679.41,-1247.42 1679.41,-1247.42 1800.59,-1247.42 1800.59,-1247.42 1806.59,-1247.42 1812.59,-1253.42 1812.59,-1259.42 1812.59,-1259.42 1812.59,-1272.32 1812.59,-1272.32 1812.59,-1278.32 1806.59,-1284.32 1800.59,-1284.32"/>
<text xml:space="preserve" text-anchor="middle" x="1740" y="-1267.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">GET /api/dcim/devices/{id}/</text>
<text xml:space="preserve" text-anchor="middle" x="1740" y="-1256.37" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- f_ret -->
<g id="node26" class="node">
<title>f_ret</title>
<path fill="#e8f4f8" stroke="#446688" d="M1983.09,-1289.95C1983.09,-1289.95 1864.91,-1289.95 1864.91,-1289.95 1858.91,-1289.95 1852.91,-1283.95 1852.91,-1277.95 1852.91,-1277.95 1852.91,-1253.8 1852.91,-1253.8 1852.91,-1247.8 1858.91,-1241.8 1864.91,-1241.8 1864.91,-1241.8 1983.09,-1241.8 1983.09,-1241.8 1989.09,-1241.8 1995.09,-1247.8 1995.09,-1253.8 1995.09,-1253.8 1995.09,-1277.95 1995.09,-1277.95 1995.09,-1283.95 1989.09,-1289.95 1983.09,-1289.95"/>
<text xml:space="preserve" text-anchor="middle" x="1924" y="-1273.25" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Return</text>
<text xml:space="preserve" text-anchor="middle" x="1924" y="-1262" font-family="Helvetica,Arial,sans-serif" font-size="10.00">device_id · device_name</text>
<text xml:space="preserve" text-anchor="middle" x="1924" y="-1250.75" font-family="Helvetica,Arial,sans-serif" font-size="10.00">interface_id · current_state</text>
</g>
<!-- f_ret&#45;&gt;fp_found -->
<g id="edge25" class="edge">
<title>f_ret&#45;&gt;fp_found</title>
<path fill="none" stroke="#555555" d="M1873.67,-1232.23C1839.42,-1210 1794.68,-1180.97 1762.68,-1160.21"/>
<polygon fill="#555555" stroke="#555555" points="1764.63,-1158.14 1756.39,-1156.14 1761.58,-1162.84 1764.63,-1158.14"/>
<text xml:space="preserve" text-anchor="middle" x="1872.16" y="-1207.67" font-family="Helvetica,Arial,sans-serif" font-size="9.00">return JSON</text>
</g>
<!-- fp_find&#45;&gt;f_upper -->
<g id="edge24" class="edge">
<title>fp_find&#45;&gt;f_upper</title>
<path fill="none" stroke="#555555" d="M1400.15,-1148.56C1293.82,-1165.16 1119.83,-1194.53 969.93,-1230.09"/>
<polygon fill="#555555" stroke="#555555" points="969.6,-1227.29 962.47,-1231.87 970.9,-1232.74 969.6,-1227.29"/>
<text xml:space="preserve" text-anchor="middle" x="1070.22" y="-1207.67" font-family="Helvetica,Arial,sans-serif" font-size="9.00">call</text>
</g>
<!-- fp_nodev -->
<g id="node29" class="node">
<title>fp_nodev</title>
<path fill="#f8d7da" stroke="#721c24" d="M1789.71,-1026.92C1789.71,-1026.92 1672.29,-1026.92 1672.29,-1026.92 1666.29,-1026.92 1660.29,-1020.92 1660.29,-1014.92 1660.29,-1014.92 1660.29,-1002.02 1660.29,-1002.02 1660.29,-996.02 1666.29,-990.02 1672.29,-990.02 1672.29,-990.02 1789.71,-990.02 1789.71,-990.02 1795.71,-990.02 1801.71,-996.02 1801.71,-1002.02 1801.71,-1002.02 1801.71,-1014.92 1801.71,-1014.92 1801.71,-1020.92 1795.71,-1026.92 1789.71,-1026.92"/>
<text xml:space="preserve" text-anchor="middle" x="1731" y="-1010.22" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_error: device not found</text>
<text xml:space="preserve" text-anchor="middle" x="1731" y="-998.97" font-family="Helvetica,Arial,sans-serif" font-size="10.00">no action taken</text>
</g>
<!-- fp_found&#45;&gt;fp_nodev -->
<g id="edge27" class="edge">
<title>fp_found&#45;&gt;fp_nodev</title>
<path fill="none" stroke="#555555" d="M1724.58,-1096.76C1725.99,-1077.58 1727.71,-1054.18 1729.02,-1036.43"/>
<polygon fill="#555555" stroke="#555555" points="1731.79,-1036.91 1729.58,-1028.73 1726.2,-1036.5 1731.79,-1036.91"/>
<text xml:space="preserve" text-anchor="middle" x="1732.29" y="-1063.37" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no</text>
</g>
<!-- fp_jrnl -->
<g id="node30" class="node">
<title>fp_jrnl</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M1608.59,-1038.17C1608.59,-1038.17 1421.41,-1038.17 1421.41,-1038.17 1415.41,-1038.17 1409.41,-1032.17 1409.41,-1026.17 1409.41,-1026.17 1409.41,-990.77 1409.41,-990.77 1409.41,-984.77 1415.41,-978.77 1421.41,-978.77 1421.41,-978.77 1608.59,-978.77 1608.59,-978.77 1614.59,-978.77 1620.59,-984.77 1620.59,-990.77 1620.59,-990.77 1620.59,-1026.17 1620.59,-1026.17 1620.59,-1032.17 1614.59,-1038.17 1608.59,-1038.17"/>
<text xml:space="preserve" text-anchor="middle" x="1515" y="-1021.47" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/extras/journal&#45;entries/</text>
<text xml:space="preserve" text-anchor="middle" x="1515" y="-1010.22" font-family="Helvetica,Arial,sans-serif" font-size="10.00">kind=success</text>
<text xml:space="preserve" text-anchor="middle" x="1515" y="-998.97" font-family="Helvetica,Arial,sans-serif" font-size="10.00">&quot;BMC discovered via DHCP — MAC / IP&quot;</text>
<text xml:space="preserve" text-anchor="middle" x="1515" y="-987.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- fp_found&#45;&gt;fp_jrnl -->
<g id="edge28" class="edge">
<title>fp_found&#45;&gt;fp_jrnl</title>
<path fill="none" stroke="#555555" d="M1686.89,-1111.07C1655.57,-1092.56 1609.14,-1065.12 1572.43,-1043.42"/>
<polygon fill="#555555" stroke="#555555" points="1573.89,-1041.03 1565.58,-1039.37 1571.04,-1045.85 1573.89,-1041.03"/>
<text xml:space="preserve" text-anchor="middle" x="1625.62" y="-1063.37" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- fp_nodev&#45;&gt;exit_ok -->
<g id="edge29" class="edge">
<title>fp_nodev&#45;&gt;exit_ok</title>
<path fill="none" stroke="#555555" d="M1801.97,-995.08C1916.66,-975.06 2139.32,-936.19 2232.91,-919.85"/>
<polygon fill="#555555" stroke="#555555" points="2233.2,-922.64 2240.6,-918.51 2232.24,-917.12 2233.2,-922.64"/>
</g>
<!-- fp_scan -->
<g id="node31" class="node">
<title>fp_scan</title>
<path fill="#e8f4f8" stroke="#446688" d="M1563.96,-929.77C1563.96,-929.77 1436.04,-929.77 1436.04,-929.77 1430.04,-929.77 1424.04,-923.77 1424.04,-917.77 1424.04,-917.77 1424.04,-904.87 1424.04,-904.87 1424.04,-898.87 1430.04,-892.87 1436.04,-892.87 1436.04,-892.87 1563.96,-892.87 1563.96,-892.87 1569.96,-892.87 1575.96,-898.87 1575.96,-904.87 1575.96,-904.87 1575.96,-917.77 1575.96,-917.77 1575.96,-923.77 1569.96,-929.77 1563.96,-929.77"/>
<text xml:space="preserve" text-anchor="middle" x="1500" y="-913.07" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Scan FSM_TRANSITIONS[]</text>
<text xml:space="preserve" text-anchor="middle" x="1500" y="-901.82" font-family="Helvetica,Arial,sans-serif" font-size="10.00">for trigger:from_state match</text>
</g>
<!-- fp_jrnl&#45;&gt;fp_scan -->
<g id="edge30" class="edge">
<title>fp_jrnl&#45;&gt;fp_scan</title>
<path fill="none" stroke="#555555" d="M1510.42,-978.41C1508.46,-965.99 1506.19,-951.58 1504.27,-939.39"/>
<polygon fill="#555555" stroke="#555555" points="1507.06,-939.13 1503.05,-931.66 1501.53,-940 1507.06,-939.13"/>
</g>
<!-- fp_match -->
<g id="node32" class="node">
<title>fp_match</title>
<path fill="#fff3cd" stroke="#856404" d="M1473.51,-831.66C1473.51,-831.66 1411.32,-812.94 1411.32,-812.94 1405.58,-811.2 1405.58,-807.74 1411.32,-806.01 1411.32,-806.01 1473.51,-787.29 1473.51,-787.29 1479.25,-785.55 1490.75,-785.55 1496.49,-787.29 1496.49,-787.29 1558.68,-806.01 1558.68,-806.01 1564.42,-807.74 1564.42,-811.2 1558.68,-812.94 1558.68,-812.94 1496.49,-831.66 1496.49,-831.66 1490.75,-833.39 1479.25,-833.39 1473.51,-831.66"/>
<text xml:space="preserve" text-anchor="middle" x="1485" y="-805.6" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Match found?</text>
</g>
<!-- fp_scan&#45;&gt;fp_match -->
<g id="edge31" class="edge">
<title>fp_scan&#45;&gt;fp_match</title>
<path fill="none" stroke="#555555" d="M1497.32,-892.47C1495.29,-878.97 1492.45,-860.03 1490,-843.76"/>
<polygon fill="#555555" stroke="#555555" points="1492.8,-843.54 1488.84,-836.05 1487.26,-844.37 1492.8,-843.54"/>
</g>
<!-- fp_nomatch -->
<g id="node33" class="node">
<title>fp_nomatch</title>
<path fill="#fff9c4" stroke="#856404" d="M1552.09,-694.95C1552.09,-694.95 1427.91,-694.95 1427.91,-694.95 1421.91,-694.95 1415.91,-688.95 1415.91,-682.95 1415.91,-682.95 1415.91,-670.05 1415.91,-670.05 1415.91,-664.05 1421.91,-658.05 1427.91,-658.05 1427.91,-658.05 1552.09,-658.05 1552.09,-658.05 1558.09,-658.05 1564.09,-664.05 1564.09,-670.05 1564.09,-670.05 1564.09,-682.95 1564.09,-682.95 1564.09,-688.95 1558.09,-694.95 1552.09,-694.95"/>
<text xml:space="preserve" text-anchor="middle" x="1490" y="-678.25" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_warn: no transition</text>
<text xml:space="preserve" text-anchor="middle" x="1490" y="-667" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST journal &#160;kind=warning</text>
</g>
<!-- fp_match&#45;&gt;fp_nomatch -->
<g id="edge32" class="edge">
<title>fp_match&#45;&gt;fp_nomatch</title>
<path fill="none" stroke="#555555" d="M1485.94,-783.84C1486.8,-761.28 1488.07,-727.94 1488.96,-704.62"/>
<polygon fill="#555555" stroke="#555555" points="1491.76,-704.92 1489.26,-696.82 1486.16,-704.7 1491.76,-704.92"/>
<text xml:space="preserve" text-anchor="middle" x="1505.95" y="-751.27" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no match</text>
</g>
<!-- a_getip -->
<g id="node34" class="node">
<title>a_getip</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M523.59,-470.52C523.59,-470.52 354.42,-470.52 354.42,-470.52 348.42,-470.52 342.42,-464.52 342.42,-458.52 342.42,-458.52 342.42,-423.12 342.42,-423.12 342.42,-417.12 348.42,-411.12 354.42,-411.12 354.42,-411.12 523.59,-411.12 523.59,-411.12 529.59,-411.12 535.59,-417.12 535.59,-423.12 535.59,-423.12 535.59,-458.52 535.59,-458.52 535.59,-464.52 529.59,-470.52 523.59,-470.52"/>
<text xml:space="preserve" text-anchor="middle" x="439" y="-453.82" font-family="Helvetica,Arial,sans-serif" font-size="10.00">GET /api/ipam/ip&#45;addresses/</text>
<text xml:space="preserve" text-anchor="middle" x="439" y="-442.57" font-family="Helvetica,Arial,sans-serif" font-size="10.00">?assigned_object_type=dcim.interface</text>
<text xml:space="preserve" text-anchor="middle" x="439" y="-431.32" font-family="Helvetica,Arial,sans-serif" font-size="10.00">&amp;assigned_object_id=IFACE_ID</text>
<text xml:space="preserve" text-anchor="middle" x="439" y="-420.07" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- fp_match&#45;&gt;a_getip -->
<g id="edge34" class="edge">
<title>fp_match&#45;&gt;a_getip</title>
<path fill="none" stroke="#555555" d="M1399.37,-809.18C1200.6,-809.99 712.99,-806.94 557,-759.82 463.33,-731.53 441.54,-605.98 437.79,-521.36"/>
<polygon fill="#555555" stroke="#555555" points="440.59,-521.42 437.5,-513.53 435,-521.63 440.59,-521.42"/>
<text xml:space="preserve" text-anchor="middle" x="488.67" y="-619.87" font-family="Helvetica,Arial,sans-serif" font-size="9.00">dhcp_seen:active</text>
</g>
<!-- o_patch -->
<g id="node39" class="node">
<title>o_patch</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M280.96,-700.57C280.96,-700.57 147.04,-700.57 147.04,-700.57 141.04,-700.57 135.04,-694.57 135.04,-688.57 135.04,-688.57 135.04,-664.42 135.04,-664.42 135.04,-658.42 141.04,-652.42 147.04,-652.42 147.04,-652.42 280.96,-652.42 280.96,-652.42 286.96,-652.42 292.96,-658.42 292.96,-664.42 292.96,-664.42 292.96,-688.57 292.96,-688.57 292.96,-694.57 286.96,-700.57 280.96,-700.57"/>
<text xml:space="preserve" text-anchor="middle" x="214" y="-683.87" font-family="Helvetica,Arial,sans-serif" font-size="10.00">PATCH /api/dcim/devices/{id}/</text>
<text xml:space="preserve" text-anchor="middle" x="214" y="-672.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">status = &quot;discovered&quot;</text>
<text xml:space="preserve" text-anchor="middle" x="214" y="-661.37" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- fp_match&#45;&gt;o_patch -->
<g id="edge35" class="edge">
<title>fp_match&#45;&gt;o_patch</title>
<path fill="none" stroke="#555555" d="M1400.64,-808.71C1145.17,-808.91 391.28,-805.58 291.25,-759.82 284.3,-756.65 277.68,-752.53 271.45,-747.83"/>
<polygon fill="#555555" stroke="#555555" points="273.47,-745.87 265.49,-743.02 269.95,-750.22 273.47,-745.87"/>
<text xml:space="preserve" text-anchor="middle" x="327.62" y="-751.27" font-family="Helvetica,Arial,sans-serif" font-size="9.00">dhcp_seen:offline</text>
</g>
<!-- d_post -->
<g id="node45" class="node">
<title>d_post</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M974.09,-470.52C974.09,-470.52 813.91,-470.52 813.91,-470.52 807.91,-470.52 801.91,-464.52 801.91,-458.52 801.91,-458.52 801.91,-423.12 801.91,-423.12 801.91,-417.12 807.91,-411.12 813.91,-411.12 813.91,-411.12 974.09,-411.12 974.09,-411.12 980.09,-411.12 986.09,-417.12 986.09,-423.12 986.09,-423.12 986.09,-458.52 986.09,-458.52 986.09,-464.52 980.09,-470.52 974.09,-470.52"/>
<text xml:space="preserve" text-anchor="middle" x="894" y="-453.82" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/ipam/ip&#45;addresses/</text>
<text xml:space="preserve" text-anchor="middle" x="894" y="-442.57" font-family="Helvetica,Arial,sans-serif" font-size="10.00">address=IP/PREFIX · status=active</text>
<text xml:space="preserve" text-anchor="middle" x="894" y="-431.32" font-family="Helvetica,Arial,sans-serif" font-size="10.00">assigned to bmc interface</text>
<text xml:space="preserve" text-anchor="middle" x="894" y="-420.07" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- fp_match&#45;&gt;d_post -->
<g id="edge36" class="edge">
<title>fp_match&#45;&gt;d_post</title>
<path fill="none" stroke="#555555" d="M1400.52,-808.85C1182.13,-808.94 611.91,-803.27 555,-742.07 526.92,-711.88 534.84,-685.27 555,-649.3 555.83,-647.81 685.37,-568.76 784.05,-508.69"/>
<polygon fill="#555555" stroke="#555555" points="785.33,-511.19 790.71,-504.64 782.42,-506.4 785.33,-511.19"/>
<text xml:space="preserve" text-anchor="middle" x="649.99" y="-619.87" font-family="Helvetica,Arial,sans-serif" font-size="9.00">dhcp_seen:discovered</text>
</g>
<!-- s_pxe -->
<g id="node49" class="node">
<title>s_pxe</title>
<path fill="#f5f5f5" stroke="#9e9e9e" stroke-dasharray="5,2" d="M745.46,-695.7C745.46,-695.7 584.54,-695.7 584.54,-695.7 578.54,-695.7 572.54,-689.7 572.54,-683.7 572.54,-683.7 572.54,-669.3 572.54,-669.3 572.54,-663.3 578.54,-657.3 584.54,-657.3 584.54,-657.3 745.46,-657.3 745.46,-657.3 751.46,-657.3 757.46,-663.3 757.46,-669.3 757.46,-669.3 757.46,-683.7 757.46,-683.7 757.46,-689.7 751.46,-695.7 745.46,-695.7"/>
<text xml:space="preserve" text-anchor="middle" x="665" y="-679" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">pxe_complete: discovered → staged</text>
<text xml:space="preserve" text-anchor="middle" x="665" y="-666.25" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">_fsm_discovered_to_staged()</text>
</g>
<!-- fp_match&#45;&gt;s_pxe -->
<g id="edge37" class="edge">
<title>fp_match&#45;&gt;s_pxe</title>
<path fill="none" stroke="#9e9e9e" stroke-dasharray="5,2" d="M1411.38,-805.5C1255.02,-798.55 894.59,-778.96 778,-742.07 766.52,-738.44 754.93,-733.53 743.76,-728.02"/>
<polygon fill="#9e9e9e" stroke="#9e9e9e" points="745.06,-725.53 736.66,-724.39 742.51,-730.52 745.06,-725.53"/>
<text xml:space="preserve" text-anchor="middle" x="900.54" y="-751.27" font-family="Helvetica,Arial,sans-serif" font-size="9.00" fill="#9e9e9e">pxe_complete:discovered</text>
</g>
<!-- fp_nomatch&#45;&gt;done -->
<g id="edge33" class="edge">
<title>fp_nomatch&#45;&gt;done</title>
<path fill="none" stroke="#555555" d="M1427.08,-657.67C1385.5,-645.69 1337.93,-631.55 1334,-628.42 1310.91,-610.07 1301,-600.34 1301,-570.85 1301,-570.85 1301,-570.85 1301,-108.35 1301,-63.11 974.23,-32.31 853.84,-22.5"/>
<polygon fill="#555555" stroke="#555555" points="854.23,-19.72 846.03,-21.87 853.78,-25.3 854.23,-19.72"/>
</g>
<!-- a_exist -->
<g id="node35" class="node">
<title>a_exist</title>
<path fill="#fff3cd" stroke="#856404" d="M433.86,-357.65C433.86,-357.65 364.22,-329.7 364.22,-329.7 358.65,-327.46 358.65,-322.99 364.22,-320.75 364.22,-320.75 433.86,-292.8 433.86,-292.8 439.43,-290.56 450.57,-290.56 456.14,-292.8 456.14,-292.8 525.78,-320.75 525.78,-320.75 531.35,-322.99 531.35,-327.46 525.78,-329.7 525.78,-329.7 456.14,-357.65 456.14,-357.65 450.57,-359.89 439.43,-359.89 433.86,-357.65"/>
<text xml:space="preserve" text-anchor="middle" x="445" y="-326.97" font-family="Helvetica,Arial,sans-serif" font-size="10.00">IP record</text>
<text xml:space="preserve" text-anchor="middle" x="445" y="-315.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">already exists?</text>
</g>
<!-- a_getip&#45;&gt;a_exist -->
<g id="edge38" class="edge">
<title>a_getip&#45;&gt;a_exist</title>
<path fill="none" stroke="#555555" d="M440.53,-410.86C441.17,-398.69 441.94,-384.24 442.65,-370.76"/>
<polygon fill="#555555" stroke="#555555" points="445.42,-371.27 443.05,-363.14 439.83,-370.98 445.42,-371.27"/>
</g>
<!-- a_patch -->
<g id="node36" class="node">
<title>a_patch</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M537.84,-230.57C537.84,-230.57 352.17,-230.57 352.17,-230.57 346.17,-230.57 340.17,-224.57 340.17,-218.57 340.17,-218.57 340.17,-194.42 340.17,-194.42 340.17,-188.42 346.17,-182.42 352.17,-182.42 352.17,-182.42 537.84,-182.42 537.84,-182.42 543.84,-182.42 549.84,-188.42 549.84,-194.42 549.84,-194.42 549.84,-218.57 549.84,-218.57 549.84,-224.57 543.84,-230.57 537.84,-230.57"/>
<text xml:space="preserve" text-anchor="middle" x="445" y="-213.87" font-family="Helvetica,Arial,sans-serif" font-size="10.00">PATCH /api/ipam/ip&#45;addresses/{id}/</text>
<text xml:space="preserve" text-anchor="middle" x="445" y="-202.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">address=IP/PREFIX · updated description</text>
<text xml:space="preserve" text-anchor="middle" x="445" y="-191.37" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- a_exist&#45;&gt;a_patch -->
<g id="edge39" class="edge">
<title>a_exist&#45;&gt;a_patch</title>
<path fill="none" stroke="#555555" d="M445,-287.93C445,-272.67 445,-255.05 445,-240.19"/>
<polygon fill="#555555" stroke="#555555" points="447.8,-240.4 445,-232.4 442.2,-240.4 447.8,-240.4"/>
<text xml:space="preserve" text-anchor="middle" x="452.12" y="-255.77" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- a_post -->
<g id="node37" class="node">
<title>a_post</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M747.96,-230.57C747.96,-230.57 602.04,-230.57 602.04,-230.57 596.04,-230.57 590.04,-224.57 590.04,-218.57 590.04,-218.57 590.04,-194.42 590.04,-194.42 590.04,-188.42 596.04,-182.42 602.04,-182.42 602.04,-182.42 747.96,-182.42 747.96,-182.42 753.96,-182.42 759.96,-188.42 759.96,-194.42 759.96,-194.42 759.96,-218.57 759.96,-218.57 759.96,-224.57 753.96,-230.57 747.96,-230.57"/>
<text xml:space="preserve" text-anchor="middle" x="675" y="-213.87" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/ipam/ip&#45;addresses/</text>
<text xml:space="preserve" text-anchor="middle" x="675" y="-202.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(no record yet — fallback assign)</text>
<text xml:space="preserve" text-anchor="middle" x="675" y="-191.37" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- a_exist&#45;&gt;a_post -->
<g id="edge40" class="edge">
<title>a_exist&#45;&gt;a_post</title>
<path fill="none" stroke="#555555" d="M485.06,-303.89C522.51,-284.89 578.73,-256.35 620.3,-235.26"/>
<polygon fill="#555555" stroke="#555555" points="621.46,-237.81 627.32,-231.7 618.92,-232.82 621.46,-237.81"/>
<text xml:space="preserve" text-anchor="middle" x="585.85" y="-255.77" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no</text>
</g>
<!-- a_jrnl -->
<g id="node38" class="node">
<title>a_jrnl</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M748.21,-133.42C748.21,-133.42 567.79,-133.42 567.79,-133.42 561.79,-133.42 555.79,-127.42 555.79,-121.42 555.79,-121.42 555.79,-97.27 555.79,-97.27 555.79,-91.27 561.79,-85.27 567.79,-85.27 567.79,-85.27 748.21,-85.27 748.21,-85.27 754.21,-85.27 760.21,-91.27 760.21,-97.27 760.21,-97.27 760.21,-121.42 760.21,-121.42 760.21,-127.42 754.21,-133.42 748.21,-133.42"/>
<text xml:space="preserve" text-anchor="middle" x="658" y="-116.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/extras/journal&#45;entries/</text>
<text xml:space="preserve" text-anchor="middle" x="658" y="-105.47" font-family="Helvetica,Arial,sans-serif" font-size="10.00">kind=info &#160;&quot;IP assigned to interface bmc&quot;</text>
<text xml:space="preserve" text-anchor="middle" x="658" y="-94.22" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- a_patch&#45;&gt;a_jrnl -->
<g id="edge41" class="edge">
<title>a_patch&#45;&gt;a_jrnl</title>
<path fill="none" stroke="#555555" d="M497.65,-181.98C527.72,-168.55 565.55,-151.65 596.92,-137.63"/>
<polygon fill="#555555" stroke="#555555" points="598.04,-140.2 604.2,-134.38 595.76,-135.09 598.04,-140.2"/>
</g>
<!-- a_post&#45;&gt;a_jrnl -->
<g id="edge42" class="edge">
<title>a_post&#45;&gt;a_jrnl</title>
<path fill="none" stroke="#555555" d="M670.8,-181.98C668.68,-170.11 666.07,-155.53 663.77,-142.63"/>
<polygon fill="#555555" stroke="#555555" points="666.58,-142.47 662.42,-135.09 661.07,-143.46 666.58,-142.47"/>
</g>
<!-- a_jrnl&#45;&gt;done -->
<g id="edge43" class="edge">
<title>a_jrnl&#45;&gt;done</title>
<path fill="none" stroke="#555555" d="M710.95,-77.27C733.88,-63.81 759.92,-48.53 779.54,-37.02"/>
<polygon fill="#555555" stroke="#555555" points="780.94,-39.44 786.42,-32.97 778.11,-34.61 780.94,-39.44"/>
</g>
<!-- o_jrnl1 -->
<g id="node40" class="node">
<title>o_jrnl1</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M288.71,-594.67C288.71,-594.67 123.29,-594.67 123.29,-594.67 117.29,-594.67 111.29,-588.67 111.29,-582.67 111.29,-582.67 111.29,-557.02 111.29,-557.02 111.29,-551.02 117.29,-545.02 123.29,-545.02 123.29,-545.02 288.71,-545.02 288.71,-545.02 294.71,-545.02 300.71,-551.02 300.71,-557.02 300.71,-557.02 300.71,-582.67 300.71,-582.67 300.71,-588.67 294.71,-594.67 288.71,-594.67"/>
<text xml:space="preserve" text-anchor="middle" x="206" y="-577.97" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/extras/journal&#45;entries/</text>
<text xml:space="preserve" text-anchor="middle" x="206" y="-566.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">kind=success &#160;&quot;offline → discovered&quot;</text>
<text xml:space="preserve" text-anchor="middle" x="206" y="-553.97" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- o_patch&#45;&gt;o_jrnl1 -->
<g id="edge44" class="edge">
<title>o_patch&#45;&gt;o_jrnl1</title>
<path fill="none" stroke="#555555" d="M212.2,-652.01C211.13,-637.94 209.74,-619.82 208.55,-604.27"/>
<polygon fill="#555555" stroke="#555555" points="211.36,-604.26 207.96,-596.49 205.78,-604.68 211.36,-604.26"/>
</g>
<!-- o_post -->
<g id="node41" class="node">
<title>o_post</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M286.08,-470.52C286.08,-470.52 125.92,-470.52 125.92,-470.52 119.92,-470.52 113.92,-464.52 113.92,-458.52 113.92,-458.52 113.92,-423.12 113.92,-423.12 113.92,-417.12 119.92,-411.12 125.92,-411.12 125.92,-411.12 286.08,-411.12 286.08,-411.12 292.08,-411.12 298.08,-417.12 298.08,-423.12 298.08,-423.12 298.08,-458.52 298.08,-458.52 298.08,-464.52 292.08,-470.52 286.08,-470.52"/>
<text xml:space="preserve" text-anchor="middle" x="206" y="-453.82" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/ipam/ip&#45;addresses/</text>
<text xml:space="preserve" text-anchor="middle" x="206" y="-442.57" font-family="Helvetica,Arial,sans-serif" font-size="10.00">address=IP/PREFIX · status=active</text>
<text xml:space="preserve" text-anchor="middle" x="206" y="-431.32" font-family="Helvetica,Arial,sans-serif" font-size="10.00">assigned to bmc interface</text>
<text xml:space="preserve" text-anchor="middle" x="206" y="-420.07" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- o_jrnl1&#45;&gt;o_post -->
<g id="edge45" class="edge">
<title>o_jrnl1&#45;&gt;o_post</title>
<path fill="none" stroke="#555555" d="M206,-544.66C206,-526.43 206,-501.08 206,-480.11"/>
<polygon fill="#555555" stroke="#555555" points="208.8,-480.34 206,-472.34 203.2,-480.34 208.8,-480.34"/>
</g>
<!-- o_400 -->
<g id="node42" class="node">
<title>o_400</title>
<path fill="#fff3cd" stroke="#856404" d="M195.02,-357.28C195.02,-357.28 133.31,-330.07 133.31,-330.07 127.82,-327.65 127.82,-322.8 133.31,-320.38 133.31,-320.38 195.02,-293.17 195.02,-293.17 200.51,-290.75 211.49,-290.75 216.98,-293.17 216.98,-293.17 278.69,-320.38 278.69,-320.38 284.18,-322.8 284.18,-327.65 278.69,-330.07 278.69,-330.07 216.98,-357.28 216.98,-357.28 211.49,-359.7 200.51,-359.7 195.02,-357.28"/>
<text xml:space="preserve" text-anchor="middle" x="206" y="-326.97" font-family="Helvetica,Arial,sans-serif" font-size="10.00">HTTP 400?</text>
<text xml:space="preserve" text-anchor="middle" x="206" y="-315.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(duplicate IP)</text>
</g>
<!-- o_post&#45;&gt;o_400 -->
<g id="edge46" class="edge">
<title>o_post&#45;&gt;o_400</title>
<path fill="none" stroke="#555555" d="M206,-410.86C206,-399.02 206,-385.02 206,-371.86"/>
<polygon fill="#555555" stroke="#555555" points="208.8,-371.97 206,-363.97 203.2,-371.97 208.8,-371.97"/>
</g>
<!-- o_warn -->
<g id="node43" class="node">
<title>o_warn</title>
<path fill="#fff9c4" stroke="#856404" d="M198.33,-224.5C198.33,-224.5 27.67,-224.5 27.67,-224.5 21.67,-224.5 15.67,-218.5 15.67,-212.5 15.67,-212.5 15.67,-200.5 15.67,-200.5 15.67,-194.5 21.67,-188.5 27.67,-188.5 27.67,-188.5 198.33,-188.5 198.33,-188.5 204.33,-188.5 210.33,-194.5 210.33,-200.5 210.33,-200.5 210.33,-212.5 210.33,-212.5 210.33,-218.5 204.33,-224.5 198.33,-224.5"/>
<text xml:space="preserve" text-anchor="middle" x="113" y="-202.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_warn: IP may already exist — skip</text>
</g>
<!-- o_400&#45;&gt;o_warn -->
<g id="edge47" class="edge">
<title>o_400&#45;&gt;o_warn</title>
<path fill="none" stroke="#555555" d="M184.66,-297.45C168.95,-277.72 147.74,-251.1 132.48,-231.95"/>
<polygon fill="#555555" stroke="#555555" points="134.86,-230.44 127.69,-225.93 130.48,-233.93 134.86,-230.44"/>
<text xml:space="preserve" text-anchor="middle" x="163.84" y="-255.77" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- o_jrnl2 -->
<g id="node44" class="node">
<title>o_jrnl2</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M289.21,-133.42C289.21,-133.42 108.79,-133.42 108.79,-133.42 102.79,-133.42 96.79,-127.42 96.79,-121.42 96.79,-121.42 96.79,-97.27 96.79,-97.27 96.79,-91.27 102.79,-85.27 108.79,-85.27 108.79,-85.27 289.21,-85.27 289.21,-85.27 295.21,-85.27 301.21,-91.27 301.21,-97.27 301.21,-97.27 301.21,-121.42 301.21,-121.42 301.21,-127.42 295.21,-133.42 289.21,-133.42"/>
<text xml:space="preserve" text-anchor="middle" x="199" y="-116.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/extras/journal&#45;entries/</text>
<text xml:space="preserve" text-anchor="middle" x="199" y="-105.47" font-family="Helvetica,Arial,sans-serif" font-size="10.00">kind=info &#160;&quot;IP assigned to interface bmc&quot;</text>
<text xml:space="preserve" text-anchor="middle" x="199" y="-94.22" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- o_400&#45;&gt;o_jrnl2 -->
<g id="edge48" class="edge">
<title>o_400&#45;&gt;o_jrnl2</title>
<path fill="none" stroke="#555555" d="M217.9,-293.13C227.36,-264.32 237.81,-220.33 230,-182.42 227.19,-168.79 221.69,-154.56 216.08,-142.37"/>
<polygon fill="#555555" stroke="#555555" points="218.66,-141.27 212.68,-135.27 213.61,-143.69 218.66,-141.27"/>
<text xml:space="preserve" text-anchor="middle" x="237.98" y="-202.82" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no</text>
</g>
<!-- o_warn&#45;&gt;o_jrnl2 -->
<g id="edge49" class="edge">
<title>o_warn&#45;&gt;o_jrnl2</title>
<path fill="none" stroke="#555555" d="M128.77,-188.05C140.72,-174.83 157.42,-156.36 171.54,-140.73"/>
<polygon fill="#555555" stroke="#555555" points="173.52,-142.72 176.8,-134.91 169.36,-138.97 173.52,-142.72"/>
</g>
<!-- o_jrnl2&#45;&gt;done -->
<g id="edge50" class="edge">
<title>o_jrnl2&#45;&gt;done</title>
<path fill="none" stroke="#555555" d="M309,-79.82C313.38,-78.92 317.73,-78.07 322,-77.27 484.37,-47.22 680.16,-29.38 766.02,-22.46"/>
<polygon fill="#555555" stroke="#555555" points="766.19,-25.26 773.95,-21.83 765.75,-19.68 766.19,-25.26"/>
</g>
<!-- d_400 -->
<g id="node46" class="node">
<title>d_400</title>
<path fill="#fff3cd" stroke="#856404" d="M886.02,-357.28C886.02,-357.28 824.31,-330.07 824.31,-330.07 818.82,-327.65 818.82,-322.8 824.31,-320.38 824.31,-320.38 886.02,-293.17 886.02,-293.17 891.51,-290.75 902.49,-290.75 907.98,-293.17 907.98,-293.17 969.69,-320.38 969.69,-320.38 975.18,-322.8 975.18,-327.65 969.69,-330.07 969.69,-330.07 907.98,-357.28 907.98,-357.28 902.49,-359.7 891.51,-359.7 886.02,-357.28"/>
<text xml:space="preserve" text-anchor="middle" x="897" y="-326.97" font-family="Helvetica,Arial,sans-serif" font-size="10.00">HTTP 400?</text>
<text xml:space="preserve" text-anchor="middle" x="897" y="-315.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(duplicate IP)</text>
</g>
<!-- d_post&#45;&gt;d_400 -->
<g id="edge51" class="edge">
<title>d_post&#45;&gt;d_400</title>
<path fill="none" stroke="#555555" d="M894.76,-410.86C895.08,-398.91 895.45,-384.77 895.8,-371.5"/>
<polygon fill="#555555" stroke="#555555" points="898.6,-371.63 896.01,-363.56 893,-371.48 898.6,-371.63"/>
</g>
<!-- d_warn -->
<g id="node47" class="node">
<title>d_warn</title>
<path fill="#fff9c4" stroke="#856404" d="M982.34,-224.5C982.34,-224.5 811.66,-224.5 811.66,-224.5 805.66,-224.5 799.66,-218.5 799.66,-212.5 799.66,-212.5 799.66,-200.5 799.66,-200.5 799.66,-194.5 805.66,-188.5 811.66,-188.5 811.66,-188.5 982.34,-188.5 982.34,-188.5 988.34,-188.5 994.34,-194.5 994.34,-200.5 994.34,-200.5 994.34,-212.5 994.34,-212.5 994.34,-218.5 988.34,-224.5 982.34,-224.5"/>
<text xml:space="preserve" text-anchor="middle" x="897" y="-202.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">log_warn: IP may already exist — skip</text>
</g>
<!-- d_400&#45;&gt;d_warn -->
<g id="edge52" class="edge">
<title>d_400&#45;&gt;d_warn</title>
<path fill="none" stroke="#555555" d="M897,-287.93C897,-270.53 897,-250.06 897,-234.12"/>
<polygon fill="#555555" stroke="#555555" points="899.8,-234.37 897,-226.37 894.2,-234.37 899.8,-234.37"/>
<text xml:space="preserve" text-anchor="middle" x="904.12" y="-255.77" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- d_jrnl -->
<g id="node48" class="node">
<title>d_jrnl</title>
<path fill="#ddc9f7" stroke="#6625a8" d="M992.21,-133.42C992.21,-133.42 811.79,-133.42 811.79,-133.42 805.79,-133.42 799.79,-127.42 799.79,-121.42 799.79,-121.42 799.79,-97.27 799.79,-97.27 799.79,-91.27 805.79,-85.27 811.79,-85.27 811.79,-85.27 992.21,-85.27 992.21,-85.27 998.21,-85.27 1004.21,-91.27 1004.21,-97.27 1004.21,-97.27 1004.21,-121.42 1004.21,-121.42 1004.21,-127.42 998.21,-133.42 992.21,-133.42"/>
<text xml:space="preserve" text-anchor="middle" x="902" y="-116.72" font-family="Helvetica,Arial,sans-serif" font-size="10.00">POST /api/extras/journal&#45;entries/</text>
<text xml:space="preserve" text-anchor="middle" x="902" y="-105.47" font-family="Helvetica,Arial,sans-serif" font-size="10.00">kind=info &#160;&quot;IP assigned to interface bmc&quot;</text>
<text xml:space="preserve" text-anchor="middle" x="902" y="-94.22" font-family="Helvetica,Arial,sans-serif" font-size="10.00">timeout 20 s</text>
</g>
<!-- d_400&#45;&gt;d_jrnl -->
<g id="edge53" class="edge">
<title>d_400&#45;&gt;d_jrnl</title>
<path fill="none" stroke="#555555" d="M935.85,-305.2C963.27,-289.4 997.89,-264.11 1014,-230.57 1023.27,-211.29 1024.25,-201.21 1014,-182.42 1003.96,-164.03 987,-149.63 969.27,-138.69"/>
<polygon fill="#555555" stroke="#555555" points="970.71,-136.3 962.4,-134.68 967.89,-141.13 970.71,-136.3"/>
<text xml:space="preserve" text-anchor="middle" x="1026.57" y="-202.82" font-family="Helvetica,Arial,sans-serif" font-size="9.00">no</text>
</g>
<!-- d_warn&#45;&gt;d_jrnl -->
<g id="edge54" class="edge">
<title>d_warn&#45;&gt;d_jrnl</title>
<path fill="none" stroke="#555555" d="M897.92,-188.05C898.58,-175.43 899.5,-158.01 900.29,-142.86"/>
<polygon fill="#555555" stroke="#555555" points="903.07,-143.43 900.69,-135.3 897.47,-143.14 903.07,-143.43"/>
</g>
<!-- d_jrnl&#45;&gt;done -->
<g id="edge55" class="edge">
<title>d_jrnl&#45;&gt;done</title>
<path fill="none" stroke="#555555" d="M869.96,-77.28C857.68,-65.37 843.93,-52.04 832.7,-41.15"/>
<polygon fill="#555555" stroke="#555555" points="834.69,-39.18 827,-35.62 830.79,-43.2 834.69,-39.18"/>
</g>
<!-- s_prov -->
<g id="node50" class="node">
<title>s_prov</title>
<path fill="#f5f5f5" stroke="#9e9e9e" stroke-dasharray="5,2" d="M936.21,-695.7C936.21,-695.7 809.79,-695.7 809.79,-695.7 803.79,-695.7 797.79,-689.7 797.79,-683.7 797.79,-683.7 797.79,-669.3 797.79,-669.3 797.79,-663.3 803.79,-657.3 809.79,-657.3 809.79,-657.3 936.21,-657.3 936.21,-657.3 942.21,-657.3 948.21,-663.3 948.21,-669.3 948.21,-669.3 948.21,-683.7 948.21,-683.7 948.21,-689.7 942.21,-695.7 936.21,-695.7"/>
<text xml:space="preserve" text-anchor="middle" x="873" y="-679" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">provisioned: staged → ready</text>
<text xml:space="preserve" text-anchor="middle" x="873" y="-666.25" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">_fsm_staged_to_ready()</text>
</g>
<!-- s_deliv -->
<g id="node51" class="node">
<title>s_deliv</title>
<path fill="#f5f5f5" stroke="#9e9e9e" stroke-dasharray="5,2" d="M1113.46,-695.7C1113.46,-695.7 1000.54,-695.7 1000.54,-695.7 994.54,-695.7 988.54,-689.7 988.54,-683.7 988.54,-683.7 988.54,-669.3 988.54,-669.3 988.54,-663.3 994.54,-657.3 1000.54,-657.3 1000.54,-657.3 1113.46,-657.3 1113.46,-657.3 1119.46,-657.3 1125.46,-663.3 1125.46,-669.3 1125.46,-669.3 1125.46,-683.7 1125.46,-683.7 1125.46,-689.7 1119.46,-695.7 1113.46,-695.7"/>
<text xml:space="preserve" text-anchor="middle" x="1057" y="-679" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">delivered: ready → active</text>
<text xml:space="preserve" text-anchor="middle" x="1057" y="-666.25" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">_fsm_ready_to_active()</text>
</g>
<!-- s_decom -->
<g id="node52" class="node">
<title>s_decom</title>
<path fill="#f5f5f5" stroke="#9e9e9e" stroke-dasharray="5,2" d="M1364.21,-695.7C1364.21,-695.7 1177.79,-695.7 1177.79,-695.7 1171.79,-695.7 1165.79,-689.7 1165.79,-683.7 1165.79,-683.7 1165.79,-669.3 1165.79,-669.3 1165.79,-663.3 1171.79,-657.3 1177.79,-657.3 1177.79,-657.3 1364.21,-657.3 1364.21,-657.3 1370.21,-657.3 1376.21,-663.3 1376.21,-669.3 1376.21,-669.3 1376.21,-683.7 1376.21,-683.7 1376.21,-689.7 1370.21,-695.7 1364.21,-695.7"/>
<text xml:space="preserve" text-anchor="middle" x="1271" y="-679" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">decommission: active → decommissioned</text>
<text xml:space="preserve" text-anchor="middle" x="1271" y="-666.25" font-family="Helvetica,Arial,sans-serif" font-size="10.00" fill="#9e9e9e">_fsm_active_to_decommissioned()</text>
</g>
</g>
</svg>
